FROM debian:bookworm-slim

ENV FRAMERATE=10 \
    RESOLUTION="640x480" \
    DEVICE="/dev/video0" \
    PORT=8080

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        build-essential \
        cmake \
        git \
        ca-certificates \
        libjpeg-dev \
        libv4l-dev \
    && rm -rf /var/lib/apt/lists/*

RUN git clone https://github.com/jacksonliam/mjpg-streamer.git /opt/mjpg-streamer && \
    cd /opt/mjpg-streamer/mjpg-streamer-experimental && \
    make && \
    make install && \
    cd / && \
    rm -rf /opt/mjpg-streamer

EXPOSE ${PORT}

ENTRYPOINT sh -c "exec mjpg_streamer -i 'input_uvc.so -d ${DEVICE} -n -f ${FRAMERATE} -r ${RESOLUTION}' -o 'output_http.so -p ${PORT} -w /usr/local/www'"
